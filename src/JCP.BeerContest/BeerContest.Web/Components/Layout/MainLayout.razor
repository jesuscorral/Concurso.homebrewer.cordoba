@using BeerContest.Domain.Models
@using Microsoft.AspNetCore.Components.Authorization
@inherits LayoutComponentBase

<div class="modern-layout">
    <!-- Top Navigation Bar -->
    <header class="modern-navbar">
        <div class="navbar-container">
            <!-- Brand Logo -->
            <a class="brand-logo" href="">
                <i class="fa fa-beer"></i>
            </a>

            <!-- Navigation Links (Left Side) -->
            <nav class="nav-links @(isNavOpen ? "nav-open" : "")">
                <a class="nav-link" href="" @onclick="CloseNav">Home</a>
                <a class="nav-link" href="rules" @onclick="CloseNav">Contest Rules</a>
                <a class="nav-link" href="register-judge" @onclick="CloseNav">Judge Registration</a>
                <a class="nav-link" href="register-beer" @onclick="CloseNav">Beer Registration</a>
                
                <AuthorizeView>
                    <Authorized>
                        
                        <AuthorizeView Roles="@($"{UserRole.Participant}")">
                            <Authorized Context="authContext">
                                <a class="nav-link" href="my-beers" @onclick="CloseNav">My Beers</a>
                            </Authorized>
                        </AuthorizeView>

                        <AuthorizeView Roles="@($"{UserRole.Judge}")">
                            <Authorized Context="authContext">
                                <a class="nav-link" href="judge-beers" @onclick="CloseNav">Judge Beers</a>
                            </Authorized>
                        </AuthorizeView>

                        <AuthorizeView Roles="@($"{UserRole.Administrator}")">
                            <Authorized Context="authContext">
                                <a class="nav-link" href="contest-management" @onclick="CloseNav">Contest Management</a>
                                <a class="nav-link" href="user-management" @onclick="CloseNav">User Management</a>
                                <a class="nav-link" href="generate-labels" @onclick="CloseNav">Generate Labels</a>
                            </Authorized>
                        </AuthorizeView>
                    </Authorized>
                </AuthorizeView>
            </nav>

            <!-- Auth Section (Right Side) -->
            <div class="auth-section">
                <AuthorizeView>
                    <NotAuthorized>
                        <a class="auth-link login-link" href="Account/Login">Log In</a>
                        <a class="auth-link register-link" href="Account/Register">Register</a>
                    </NotAuthorized>
                    <Authorized>
                        <div class="user-menu">
                            <span class="user-name">Welcome, @(context.User.Identity?.Name ?? "User")</span>
                            <a class="auth-link logout-link" href="Account/Logout">Logout</a>
                        </div>
                    </Authorized>
                </AuthorizeView>
            </div>

            <!-- Mobile menu toggle -->
            <button class="mobile-menu-toggle" @onclick="ToggleNav" aria-expanded="@isNavOpen">
                <span class="hamburger-line"></span>
                <span class="hamburger-line"></span>
                <span class="hamburger-line"></span>
            </button>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        @Body
    </main>
</div>

<!-- Include navigation JavaScript -->
<script src="~/js/navigation.js"></script>

<div id="blazor-error-ui">
    @if (System.Environment.GetEnvironmentVariable("ASPNETCORE_ENVIRONMENT") == "Development")
    {
        <text>An error has occurred. This application may no longer respond until reloaded.</text>
    }
    else
    {
        <text>An unexpected error has occurred.</text>
    }
    <a href="" class="reload">Reload</a>
    <a class="dismiss">ðŸ—™</a>
</div>

@code {
    private bool isNavOpen = false;

    private void ToggleNav()
    {
        isNavOpen = !isNavOpen;
    }

    private void CloseNav()
    {
        isNavOpen = false;
    }
}
